{% extends 'base.html.twig' %}

{% block body %}

<style>

/* =========================
   GLOBAL ESPORT THEME 2026
=========================*/
:root{
    --bg:#020617;
    --card:rgba(15,23,42,0.65);
    --border:rgba(255,255,255,0.06);
    --text:#e2e8f0;
    --muted:#94a3b8;
    --pink:#ec4899;
    --violet:#8b5cf6;
    --blue:#3b82f6;
}

/* Page */
.page-container{
    background: radial-gradient(circle at top,#0f172a,#020617);
    min-height:100vh;
}

/* =========================
   HERO
=========================*/
.hero-section{
    position:relative;
    padding:110px 20px 70px;
    text-align:center;
    overflow:hidden;
}

.hero-bg{
    position:absolute;
    inset:0;
    background:
        radial-gradient(circle at 30% 20%, rgba(236,72,153,0.15), transparent 40%),
        radial-gradient(circle at 70% 60%, rgba(139,92,246,0.12), transparent 40%);
    filter:blur(40px);
    z-index:-1;
}

.page-title{
    font-size:clamp(3rem,7vw,5rem);
    font-weight:900;
    letter-spacing:-2px;
    margin-bottom:15px;
    background:linear-gradient(90deg,var(--pink),var(--violet),var(--blue));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

.stats-badge{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:12px 22px;
    border-radius:999px;
    background:var(--card);
    backdrop-filter:blur(14px);
    border:1px solid var(--border);
    font-weight:600;
    color:var(--muted);
}

.stats-count{
    font-size:1.2rem;
    font-weight:800;
    color:var(--pink);
}

/* =========================
   GRID
=========================*/
.teams-grid{
    max-width:1400px;
    margin:auto;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
    gap:40px;
    padding:40px 30px 90px;
}

/* =========================
   CARD NEXT GEN
=========================*/
.team-card{
    position:relative;
    background:var(--card);
    backdrop-filter:blur(18px);
    border-radius:24px;
    padding:35px;
    border:1px solid var(--border);
    overflow:hidden;
    transition:.4s cubic-bezier(.34,1.56,.64,1);
}

.team-card::before{
    content:"";
    position:absolute;
    inset:0;
    background:linear-gradient(120deg,transparent,rgba(255,255,255,0.06),transparent);
    opacity:0;
    transition:.4s;
    pointer-events: none;
}

.team-card:hover{
    transform:translateY(-12px) scale(1.02);
    box-shadow:0 25px 60px rgba(0,0,0,0.6);
}

.team-card:hover::before{
    opacity:1;
}

/* Number */
.team-number{
    position:absolute;
    top:15px;
    right:20px;
    font-size:3rem;
    font-weight:900;
    color:rgba(255,255,255,0.05);
}

/* Avatar */
.team-avatar{
    width:90px;
    height:90px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,#020617,#0f172a);
    border:2px solid rgba(255,255,255,0.05);
    margin-bottom:20px;
    font-size:2.4rem;
}

/* Name */
.team-name{
    font-size:1.6rem;
    font-weight:800;
    text-align:center;
    margin-bottom:30px;
    position: relative;
    z-index: 2;
}

/* Ensure content acts above the absolute background */
.team-header, .team-avatar, .team-meta, .team-number {
    position: relative;
    z-index: 2;
}

/* =========================
   BUTTONS
=========================*/
.team-actions{
    display:flex;
    gap:12px;
    position: relative;
    z-index: 3;
}

.btn{
    flex:1;
    padding:13px;
    border-radius:14px;
    font-weight:600;
    border:none;
    cursor:pointer;
    transition:.25s;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    text-decoration:none;
}

.btn-view{
    background:rgba(255,255,255,0.05);
    color:var(--muted);
}

.btn-view:hover{
    background:rgba(255,255,255,0.1);
    color:white;
}

.btn-join{
    background:linear-gradient(135deg,var(--pink),#db2777);
    color:white;
    box-shadow:0 10px 25px rgba(236,72,153,0.35);
}

.btn-join:hover{
    transform:translateY(-2px);
    box-shadow:0 18px 40px rgba(236,72,153,0.55);
}

/* =========================
   EMPTY
=========================*/
.empty-state{
    grid-column:1/-1;
    text-align:center;
    padding:90px;
    border-radius:25px;
    background:var(--card);
    border:2px dashed var(--border);
}

.empty-icon{
    font-size:4rem;
    opacity:.15;
    margin-bottom:15px;
}

.empty-text{
    color:var(--muted);
    font-size:1.2rem;
}

/* =========================
   MODAL MODERN
=========================*/
.modal-overlay{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.8);
    backdrop-filter:blur(8px);
    z-index:1000;
    justify-content:center;
    align-items:center;
}

.modal-overlay.active{
    display:flex;
}

.modal-content{
    background:rgba(15,23,42,0.95);
    border-radius:22px;
    padding:35px;
    max-width:520px;
    width:90%;
    border:1px solid var(--border);
    box-shadow:0 30px 80px rgba(0,0,0,0.7);
}

.modal-header-title{
    font-size:1.9rem;
    font-weight:800;
    margin-bottom:20px;
    background:linear-gradient(90deg,var(--pink),var(--violet));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}


/* Modal Internals */
.modal-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 25px;
    background: rgba(255,255,255,0.03);
    padding: 15px;
    border-radius: 12px;
}

.info-item {
    display: flex;
    flex-direction: column;
}

.info-item .label {
    font-size: 0.8rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.info-item .value {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text);
}

.modal-members-section h3 {
    font-size: 1.2rem;
    color: var(--text);
    margin-bottom: 15px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 10px;
}

.members-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 200px;
    overflow-y: auto;
    padding-right: 5px;
}

.member-row {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255,255,255,0.02);
    padding: 10px;
    border-radius: 10px;
    transition: 0.2s;
}

.member-row:hover {
    background: rgba(255,255,255,0.05);
}

.member-avatar {
    width: 36px;
    height: 36px;
    background: rgba(139, 92, 246, 0.2);
    color: var(--violet);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.member-details {
    display: flex;
    flex-direction: column;
}

.member-name {
    font-weight: 600;
    font-size: 0.95rem;
}

.member-role {
    font-size: 0.75rem;
    color: var(--muted);
}

.no-members {
    text-align: center;
    color: var(--muted);
    padding: 20px;
    border: 1px dashed var(--border);
    border-radius: 10px;
}
</style>

<script>
function openModal(id){
    const m=document.getElementById(id);
    if(m){m.classList.add('active')}
}
function closeModal(id){
    const m=document.getElementById(id);
    if(m){m.classList.remove('active')}
}
</script>

<div class="page-container">

    <div class="hero-section">
        <div class="hero-bg"></div>
        <h1 class="page-title">Active Rosters</h1>

        <div class="stats-badge">
            Total Teams
            <span class="stats-count">{{ equipes|length }}</span>
        </div>
    </div>

    <div class="teams-grid">

        {% for equipe in equipes %}
            {% set is_member = user_team_ids is defined and equipe.id in user_team_ids %}
            {% include 'equipe/card.html.twig' with { equipe: equipe, is_member: is_member|default(false), rankingByTeamId: rankingByTeamId|default({}) } %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon"><i class="fas fa-ghost"></i></div>
                <p class="empty-text">No teams yet. Start your esports legacy.</p>
                <br>
                <a href="{{ path('app_equipe_new') }}" class="btn btn-join">
                    Create Team
                </a>
            </div>
        {% endfor %}

    </div>


    <!-- Modals (Placed outside grid to avoid stacking context issues) -->
    {% for equipe in equipes %}
    <div id="modal-{{ equipe.id }}" class="modal-overlay">
        <div class="modal-content">

            <div class="modal-header">
                <h2 class="modal-header-title">
                    {{ equipe.nom }}
                </h2>
            </div>

            <div class="modal-body">

                <div class="modal-info-grid">
                    <div class="info-item">
                        <span class="label">Team ID</span>
                        <span class="value">#{{ equipe.id }}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Tournaments</span>
                        <span class="value">
                            {% if equipe.tournois is defined and equipe.tournois is not empty %}
                                {% for t in equipe.tournois %}
                                    {{ t.nom }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            {% else %}
                                Not Registered
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="modal-members-section">
                    <h3><i class="fas fa-users"></i> Roster</h3>
                    <div class="members-list">
                        {% if equipe.members is defined and equipe.members|length > 0 %}
                            {% for membre in equipe.members %}
                                <div class="member-row">
                                    <div class="member-avatar">
                                        <i class="fas fa-user-astronaut"></i>
                                    </div>
                                    <div class="member-details">
                                        <span class="member-name">{{ membre.nom ?? membre.userIdentifier }}</span>
                                        <span class="member-role">
                                            {% if equipe.owner == membre %}Owner{% else %}Member{% endif %}
                                        </span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-members">
                                <i class="fas fa-user-slash"></i>
                                <span>No active players</span>
                            </div>
                        {% endif %}
                    </div>
                </div>

            </div>

            <div class="modal-actions">

                {% if pendingTeamIds is defined and equipe.id in pendingTeamIds %}
                <span class="btn" style="flex:1;background:rgba(245,158,11,0.15);color:#f59e0b;border:1px solid rgba(245,158,11,0.3);cursor:default;padding:13px;border-radius:14px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px;">
                    <i class="fas fa-clock"></i>
                    ⏳ En attente
                </span>
                {% else %}
                <a href="{{ path('app_equipe_join', {id: equipe.id}) }}"
                   class="btn btn-join">
                    <i class="fas fa-users"></i>
                    Join Team
                </a>
                {% endif %}

                <button class="btn btn-close"
                        onclick="closeModal('modal-{{ equipe.id }}')">
                    ✕ Close
                </button>

            </div>

        </div>
    </div>
    {% endfor %}

    <style>
    /* Ensure modal actions are styled */
    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 25px;
        padding-top: 25px;
        border-top: 1px solid var(--border);
    }
    .btn-close {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--muted);
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
    }
    .btn-close:hover {
        background: rgba(255,255,255,0.05);
        color: #fff;
    }
    </style>

</div>

{% endblock %}
